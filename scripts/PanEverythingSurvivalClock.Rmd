---
title: "PanEverythingSurvivalClock"
output: html_notebook
---

```{r message=FALSE, warning=FALSE, include=FALSE}
library(e1071) 
library(caTools) 
library(class)
library(TimeSeriesExperiment)
library(SummarizedExperiment)
library(Biobase)
library(ggplot2)
library(caret)
# source("InitialSteps.Rmd")
knitr::knit("ModelBuilding.Rmd", output = tempfile())
knitr::knit("Analysis.Rmd", output = tempfile())
source("PanClockHelperFunctions.R")
```

```{r}
# Ideal structure
# experimentsList <- InitialSteps()
# mlModelPredictionsList <- ModelBuilding(experimentsList)
# output <- Output(mlModelPredictionsList[["model"]], mlModelPredictionsList[["predictions"]])
```

# Get the output of the ML model
```{r}
# Complete Set
existingExperimentList <- NULL # comment in if first time running with layer and cancer combination
# modelOutput <- standardizedModelBuilding(c("methylation", "RNAseq"), cancerName="HNSC", existingExperimentList=existingExperimentList)

# Holdouts
modelOutput <- standardizedModelBuilding(c("RNAseq"), cancerName="HNSC", methodNames=c("glmnet", "svmLinear", "ranger"), splitSize=0.8, seed=43, existingExperimentsList=existingExperimentList)
existingExperimentList <- modelOutput$experimentList
```


# Survival analysis given model just ran
```{r}
stats <- getSurvivalStats(modelOutput$experimentList[[1]], modelOutput$ModelBuilding$predicted)
print(summary(stats$interaction_model))

# outFile <- "/restricted/projectnb/agedisease/projects/pancancer_aging_clocks/results/ElasticNet_HNSC_HPV_Negative/ElasticNetMethylationRNAseqHoldoutsSeed44.csv"
# write.csv(modelOutput$ModelBuilding$predicted, outFile, row.names = FALSE)
```

# Survival analysis given previous data
```{r}
results <- read.csv("/restricted/projectnb/agedisease/projects/pancancer_aging_clocks/results/ElasticNet_HNSC_HPV_Negative/ElasticNetRNAseqCompleteSet.csv")
experiment <- getExperimentByLayerAndCancer("miRNA", "HNSC")
stats <- getSurvivalStats(experiment[[1]], results)
summary(stats$interaction_model)
```

